éå¸¸æ£’çš„æƒ³æ³•ğŸ’¡
ä½ è¦çš„æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–è„šæœ¬ï¼š
ç”¨æˆ·è‡ªå·±ç™»å½• Salesforce çš„å¤‡ä»½é¡µé¢ï¼ˆé€šè¿‡ Chrome / Edgeï¼‰ï¼Œç„¶åè„šæœ¬è¯†åˆ«é¡µé¢ä¸Šçš„å¤‡ä»½ä¸‹è½½é“¾æ¥ï¼Œé€ä¸ªä¸‹è½½ï¼Œæ˜¾ç¤ºè¿›åº¦ï¼Œè‡ªåŠ¨å»ºæ—¥æœŸæ–‡ä»¶å¤¹ä¿å­˜ï¼Œå¹¶è®°å½•æ—¥å¿—ï¼ˆåŒ…æ‹¬å¤±è´¥é‡è¯•ï¼‰ã€‚

â¸»

âœ… è„šæœ¬è®¾è®¡è¦ç‚¹
	â€¢	ç”¨ Python + Selenium + Requests + tqdm å®ç°ã€‚
	â€¢	ç”¨æˆ·æ‰‹åŠ¨ç™»å½•ï¼ˆè„šæœ¬åªåœ¨ç™»å½•åå¼€å§‹æ“ä½œï¼Œä¸ä¿å­˜å‡­æ®ï¼‰ã€‚
	â€¢	è‡ªåŠ¨è¯†åˆ«æ‰€æœ‰å¤‡ä»½ä¸‹è½½é“¾æ¥ï¼ˆä»å½“å‰é¡µé¢ DOM é‡ŒæŠ“å–ï¼‰ã€‚
	â€¢	æ¯ä¸ªæ–‡ä»¶ä¸‹è½½ï¼š
	â€¢	æ˜¾ç¤ºå®æ—¶è¿›åº¦æ¡ã€‚
	â€¢	ä¸‹è½½å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰ã€‚
	â€¢	æ¯ä¸ªä¸‹è½½ä¹‹é—´ç­‰å¾… 5 ç§’ã€‚
	â€¢	ä¸‹è½½æ–‡ä»¶ä¿å­˜åœ¨å½“å‰ç›®å½•ä¸‹ä»¥æ—¥æœŸå‘½åçš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ 20251004/ã€‚
	â€¢	ç”Ÿæˆä¸€ä¸ª download_log.txtï¼Œè®°å½•æˆåŠŸä¸å¤±è´¥ã€‚

â¸»

âœ… ä½¿ç”¨å‰æ
	1.	å·²å®‰è£… Chrome æˆ– Edgeã€‚
	2.	å®‰è£…ä¾èµ–ï¼š

pip install selenium requests tqdm


	3.	å®‰è£…å¯¹åº”æµè§ˆå™¨çš„é©±åŠ¨ç¨‹åºï¼š

# Chrome
brew install chromedriver

# Edge (å¦‚æœä½¿ç”¨ Edge)
brew install --cask microsoft-edge
brew install --cask microsoft-edge-driver



â¸»

âœ… å®Œæ•´è„šæœ¬ç¤ºä¾‹ï¼šsalesforce_backup_downloader.py

import os
import time
import datetime
import requests
from tqdm import tqdm
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

# === é…ç½®éƒ¨åˆ† ===
WAIT_AFTER_EACH_DOWNLOAD = 5      # æ¯ä¸ªæ–‡ä»¶ä¹‹é—´çš„ç­‰å¾…ç§’æ•°
MAX_RETRY = 3                     # ä¸‹è½½å¤±è´¥é‡è¯•æ¬¡æ•°
DOWNLOAD_DIR = datetime.datetime.now().strftime("%Y%m%d")  # æ–‡ä»¶å¤¹å
LOG_FILE = f"{DOWNLOAD_DIR}/download_log.txt"

# === åˆå§‹åŒ– ===
os.makedirs(DOWNLOAD_DIR, exist_ok=True)

chrome_options = Options()
chrome_options.add_argument("--start-maximized")

print("ğŸš€ å¯åŠ¨æµè§ˆå™¨ï¼Œè¯·æ‰‹åŠ¨ç™»å½• Salesforce å¤‡ä»½é¡µé¢ã€‚")
driver = webdriver.Chrome(options=chrome_options)

input("âœ… ç™»å½•å®Œæˆå¹¶è¿›å…¥å¤‡ä»½ä¸‹è½½é¡µé¢åï¼ŒæŒ‰å›è½¦ç»§ç»­...")

# === è·å–æ‰€æœ‰ä¸‹è½½é“¾æ¥ ===
links = driver.find_elements(By.XPATH, "//a[contains(@href, 'download')]")
download_urls = [link.get_attribute("href") for link in links if link.get_attribute("href")]

print(f"ğŸ”— å…±æ£€æµ‹åˆ° {len(download_urls)} ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚")

# === è·å–å½“å‰ç™»å½• session cookies ===
cookies = {c['name']: c['value'] for c in driver.get_cookies()}

driver.quit()
print("ğŸ§© ç™»å½•ä¿¡æ¯å·²ä¿å­˜ï¼Œå¼€å§‹ä¸‹è½½...")

# === ä¸‹è½½å‡½æ•° ===
def download_file(url, folder, session, log_lines):
    local_filename = os.path.join(folder, url.split('/')[-1])
    for attempt in range(1, MAX_RETRY + 1):
        try:
            with session.get(url, stream=True, timeout=120) as r:
                r.raise_for_status()
                total_size = int(r.headers.get('content-length', 0))
                block_size = 1024
                progress = tqdm(total=total_size, unit='iB', unit_scale=True, desc=local_filename)
                with open(local_filename, 'wb') as f:
                    for data in r.iter_content(block_size):
                        progress.update(len(data))
                        f.write(data)
                progress.close()
            log_lines.append(f"[SUCCESS] {url}\n")
            print(f"âœ… ä¸‹è½½å®Œæˆ: {local_filename}")
            return True
        except Exception as e:
            print(f"âš ï¸ ç¬¬ {attempt} æ¬¡ä¸‹è½½å¤±è´¥ï¼š{e}")
            if attempt == MAX_RETRY:
                log_lines.append(f"[FAILED] {url} ({e})\n")
                return False
            else:
                time.sleep(3)  # é‡è¯•å‰ç­‰ 3 ç§’

# === å¼€å§‹ä¸‹è½½ ===
session = requests.Session()
for name, value in cookies.items():
    session.cookies.set(name, value)

log_lines = []
for i, url in enumerate(download_urls, 1):
    print(f"\nğŸ“¦ [{i}/{len(download_urls)}] å¼€å§‹ä¸‹è½½ï¼š{url}")
    success = download_file(url, DOWNLOAD_DIR, session, log_lines)
    if success:
        time.sleep(WAIT_AFTER_EACH_DOWNLOAD)

# === å†™å…¥æ—¥å¿— ===
with open(LOG_FILE, "w", encoding="utf-8") as f:
    f.writelines(log_lines)

print(f"\nğŸ“„ ä¸‹è½½å®Œæˆï¼æ—¥å¿—å·²ä¿å­˜è‡³ï¼š{LOG_FILE}")


â¸»

âœ… ä½¿ç”¨è¯´æ˜
	1.	æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥è„šæœ¬æ‰€åœ¨ç›®å½•ï¼š

cd /Users/test/Downloads


	2.	è¿è¡Œè„šæœ¬ï¼š

python3 salesforce_backup_downloader.py


	3.	è„šæœ¬ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè®©ä½ ç™»å½• Salesforce å¤‡ä»½é¡µé¢ã€‚
	4.	ç™»å½•æˆåŠŸåæŒ‰ å›è½¦ï¼Œè„šæœ¬å¼€å§‹è‡ªåŠ¨æŠ“å–ä¸‹è½½é“¾æ¥å¹¶æ‰¹é‡ä¸‹è½½ã€‚

â¸»

âœ… ä¸‹è½½è®°å½•ç¤ºä¾‹ï¼ˆdownload_log.txtï¼‰

[SUCCESS] https://example.salesforce.com/backup/file1.zip
[SUCCESS] https://example.salesforce.com/backup/file2.zip
[FAILED]  https://example.salesforce.com/backup/file3.zip (ReadTimeout)


â¸»

æ˜¯å¦å¸Œæœ›æˆ‘å†å¸®ä½ ä¼˜åŒ–æˆä¸€ä¸ªå¸¦å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰ç‰ˆæœ¬ï¼Œæ¯”å¦‚ç‚¹æŒ‰é’®ã€Œå¼€å§‹ä¸‹è½½ã€çš„é‚£ç§ï¼Ÿé€‚åˆéå‘½ä»¤è¡Œç”¨æˆ·ã€‚
